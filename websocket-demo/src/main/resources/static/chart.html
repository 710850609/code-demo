<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>聊天</title>
</head>
<body>
    <div>
        <input id="uri" value="ws://localhost:8800/chart">
        <button onclick="connect()">连接</button>
        <label id="connectResult"></label>
    </div>
    <div>
        <input id="message">
        <button onclick="send()">发送</button>
    </div>
    <div>
        <label id="returnMessage"></label>
    </div>
</body>
<script src="/js/notify.js"></script>
<script type="application/javascript">
    var ws = undefined
    connect()

    function connect() {
        var uri = document.getElementById("uri").value
        ws = webSocket(uri, onMessage, onOpen, onError, onClose)
    }

    function send() {
        var message = document.getElementById("message").value
        console.log(message)
        ws.send(message)
        notify({title: 'ttt', message: message, data: {n: '123'}, click: (d) => {console.log(d)}})
    }

    function showConnectionResult(msg) {
        document.getElementById("connectResult").innerText = msg
    }

    function showReturnMessage(msg) {
        document.getElementById("returnMessage").innerText = msg
    }

    function onMessage(event) {
        console.log('onMessage')
        showReturnMessage(event.data)
    }

    function onOpen(event) {
        console.log('连接成功')
        showConnectionResult('连接成功')
        console.log(event)
    }

    function onError(error) {
        console.log('onError')
        showConnectionResult('连接错误')
        console.log(error)
    }

    function onClose(session) {
        console.log('onClose')
        showConnectionResult('连接关闭')
        console.log(session)
    }

    function webSocket(uri, onMessage, onOpen, onError, onClose) {
        var ws = new WebSocket(uri);
        ws.onmessage = onMessage
        ws.onopen = onOpen
        ws.onerror = onError
        ws.onclose = onClose
        return ws
    }

</script>
</html>